/*! Fast Average Color | Â© 2020 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).FastAverageColor=e()}(this,function(){"use strict";function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t){var e=t.toString(16);return 1===e.length?"0"+e:e}function i(t){return"#"+t.map(e).join("")}function m(t,e,r){if("function"==typeof r)return r(t,e);for(var n,o,i,a=0;a<r.lenght;a++){var s=r[a];switch(s.length){case 3:if(i=s,255!==(n=t)[(o=e)+3]||n[o]===i[0]&&n[o+1]===i[1]&&n[o+2]===i[2])return 1;break;case 4:if(function(t,e,r){if(t[e+3]&&r[3])return t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]&&t[e+3]===r[3];return t[e+3]===r[3]}(t,e,s))return 1;break;case 5:if(function(t,e,r){var n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],c=t[e+3];if(!a)return h(c,a,s);var u=h(c,a,s);if(!c&&u)return!0;if(h(t[e],n,s)&&h(t[e+1],o,s)&&h(t[e+2],i,s)&&u)return!0;return!1}(t,e,s))return 1}}}function h(t,e,r){return t<=e-r&&e+r<=t}function c(t,e,r){for(var n={},o=r.ignoredColor,i=0;i<e;i+=r.step){var a,s=t[i],c=t[i+1],u=t[i+2],h=t[i+3];o&&m(t,i,o)||(a=Math.round(s/24)+","+Math.round(c/24)+","+Math.round(u/24),n[a]?n[a]=[n[a][0]+s*h,n[a][1]+c*h,n[a][2]+u*h,n[a][3]+h,n[a][4]+1]:n[a]=[s*h,c*h,u*h,h,1])}var d=Object.keys(n).map(function(t){return n[t]}).sort(function(t,e){var r=t[4],n=e[4];return n<r?-1:r===n?0:1})[0],f=d[0],l=d[1],g=d[2],v=d[3],p=d[4];return v?[Math.round(f/v),Math.round(l/v),Math.round(g/v),Math.round(v/p)]:r.defaultColor}function u(t,e,r){for(var n=0,o=0,i=0,a=0,s=0,c=r.ignoredColor,u=0;u<e;u+=r.step){var h=t[u+3],d=t[u]*h,f=t[u+1]*h,l=t[u+2]*h;c&&m(t,u,c)||(n+=d,o+=f,i+=l,a+=h,s++)}return a?[Math.round(n/a),Math.round(o/a),Math.round(i/a),Math.round(a/s)]:r.defaultColor}function d(t,e,r){for(var n=0,o=0,i=0,a=0,s=0,c=r.ignoredColor,u=0;u<e;u+=r.step){var h=t[u],d=t[u+1],f=t[u+2],l=t[u+3];c&&m(t,u,c)||(n+=h*h*l,o+=d*d*l,i+=f*f*l,a+=l,s++)}return a?[Math.round(Math.sqrt(n/a)),Math.round(Math.sqrt(o/a)),Math.round(Math.sqrt(i/a)),Math.round(a/s)]:r.defaultColor}function f(t){return l(t,"defaultColor",[0,0,0,0])}function l(t,e,r){return void 0===t[e]?r:t[e]}var n="FastAverageColor: ";function g(t,e,r){t.silent||(console.error("".concat(n).concat(e)),r&&console.error(r))}function v(t){return Error(n+t)}return function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"getColorAsync",value:function(t,e){if(!t)return Promise.reject(v("call .getColorAsync() without resource."));if("string"==typeof t){var r=new Image;return r.crossOrigin="",r.src=t,this._bindImageEvents(r,e)}if(t instanceof Image&&!t.complete)return this._bindImageEvents(t,e);var n=this.getColor(t,e);return n.error?Promise.reject(n.error):Promise.resolve(n)}},{key:"getColor",value:function(e,r){var t=f(r=r||{});if(!e)return g(r,"call .getColor(null) without resource."),this.prepareResult(t);var n,o=(n=e)instanceof HTMLImageElement?{width:n.naturalWidth,height:n.naturalHeight}:n instanceof HTMLVideoElement?{width:n.videoWidth,height:n.videoHeight}:{width:n.width,height:n.height},i=this._prepareSizeAndPosition(o,r);if(!(i.srcWidth&&i.srcHeight&&i.destWidth&&i.destHeight))return g(r,'incorrect sizes for resource "'.concat(e.src,'".')),this.prepareResult(t);if(!this._ctx&&(this._canvas="undefined"==typeof window?new OffscreenCanvas(1,1):document.createElement("canvas"),this._ctx=this._canvas.getContext&&this._canvas.getContext("2d"),!this._ctx))return g(r,"Canvas Context 2D is not supported in this browser."),this.prepareResult(t);this._canvas.width=i.destWidth,this._canvas.height=i.destHeight;var a=t;try{this._ctx.clearRect(0,0,i.destWidth,i.destHeight),this._ctx.drawImage(e,i.srcLeft,i.srcTop,i.srcWidth,i.srcHeight,0,0,i.destWidth,i.destHeight);var s=this._ctx.getImageData(0,0,i.destWidth,i.destHeight).data,a=this.getColorFromArray4(s,r)}catch(t){g(r,"security error (CORS) for resource ".concat(e.src,".\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image"),t)}return this.prepareResult(a)}},{key:"getColorFromArray4",value:function(t,e){e=e||{};var r=t.length,n=f(e);if(r<4)return n;var o,i,a=r-r%4,s=4*(e.step||1);switch(e.algorithm||"sqrt"){case"simple":o=u;break;case"sqrt":o=d;break;case"dominant":o=c;break;default:throw v("".concat(e.algorithm," is unknown algorithm."))}return o(t,a,{defaultColor:n,ignoredColor:"function"!=typeof(i=e.ignoredColor)&&Array.isArray(i)&&!Array.isArray(i[0])?[[].concat(i)]:i,step:s})}},{key:"prepareResult",value:function(t){var e,r=t.slice(0,3),n=[].concat(r,t[3]/255),o=(299*(e=t)[0]+587*e[1]+114*e[2])/1e3<128;return{value:t,rgb:"rgb("+r.join(",")+")",rgba:"rgba("+n.join(",")+")",hex:i(r),hexa:i(t),isDark:o,isLight:!o}}},{key:"destroy",value:function(){delete this._canvas,delete this._ctx}},{key:"_prepareSizeAndPosition",value:function(t,e){var r=l(e,"left",0),n=l(e,"top",0),o=l(e,"width",t.width),i=l(e,"height",t.height),a=o,s=i;if("precision"===e.mode)return{srcLeft:r,srcTop:n,srcWidth:o,srcHeight:i,destWidth:a,destHeight:s};var c;return i<o?(c=o/i,a=100,s=Math.round(a/c)):(c=i/o,s=100,a=Math.round(s/c)),(o<a||i<s||a<10||s<10)&&(a=o,s=i),{srcLeft:r,srcTop:n,srcWidth:o,srcHeight:i,destWidth:a,destHeight:s}}},{key:"_bindImageEvents",value:function(a,s){var c=this;return new Promise(function(e,r){function t(){i();var t=c.getColor(a,s);t.error?r(t.error):e(t)}function n(){i(),r(v("Error loading image ".concat(a.src,".")))}function o(){i(),r(v('Image "'.concat(a.src,'" loading aborted.')))}var i=function(){a.removeEventListener("load",t),a.removeEventListener("error",n),a.removeEventListener("abort",o)};a.addEventListener("load",t),a.addEventListener("error",n),a.addEventListener("abort",o)})}}])&&o(e.prototype,r),n&&o(e,n),t}()});
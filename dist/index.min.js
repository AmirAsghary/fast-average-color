/*! Fast Average Color | Â© 2018 Denis Seleznev | MIT License | https://github.com/hcodes/fast-average-color/ */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.FastAverageColor=e()}(this,function(){"use strict";var e=function(){function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}();return function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return e(t,[{key:"getColorFromUnloadedImage",value:function(t,e,r){var i=r&&r.data;t.complete||t.naturalWidth?e.call(t,this.getColor.apply(this,arguments),i):this._bindImageEvents(t,e,r)}},{key:"getColor",value:function(t,e){e=e||{};var r=this._getDefaultColor(e),i=this._getOriginalSize(t),n=this._prepareSizeAndPosition(i,e),o=null,a=r;if(!(n.srcWidth&&n.srcHeight&&n.destWidth&&n.destHeight))return this._prepareResult(r,new Error("FastAverageColor: Incorrect sizes."));if(!this._ctx&&(this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext&&this._canvas.getContext("2d"),!this._ctx))return this._prepareResult(r,new Error("FastAverageColor: Canvas Context 2D is not supported in this browser."));this._canvas.width=n.destWidth,this._canvas.height=n.destHeight;try{this._ctx.clearRect(0,0,n.destWidth,n.destHeight),this._ctx.drawImage(t,n.srcLeft,n.srcTop,n.srcWidth,n.srcHeight,0,0,n.destWidth,n.destHeight);var s=this._ctx.getImageData(0,0,n.destWidth,n.destHeight).data;a=this.getColorFromArray4(s,e)}catch(t){o=t}return this._prepareResult(a,o)}},{key:"getColorFromArray4",value:function(t,e){e=e||{};var r=t.length;if(r<4)return this._getDefaultColor(e);var i=r-r%4,n=4*(e.step||1);return"simple"===e.algorithm?this._simpleAlgorithm(t,i,n):this._sqrtAlgorithm(t,i,n)}},{key:"destroy",value:function(){delete this._canvas,delete this._ctx}},{key:"_getDefaultColor",value:function(t){return this._getOption(t,"defaultColor",[255,255,255,255])}},{key:"_getOption",value:function(t,e,r){return void 0===t[e]?r:t[e]}},{key:"_prepareSizeAndPosition",value:function(t,e){var r=this._getOption(e,"left",0),i=this._getOption(e,"top",0),n=this._getOption(e,"width",t.width),o=this._getOption(e,"height",t.height),a=n,s=o;if("precision"===e.mode)return{srcLeft:r,srcTop:i,srcWidth:n,srcHeight:o,destWidth:a,destHeight:s};var h=void 0;return o<n?(h=n/o,a=100,s=Math.round(a/h)):(h=o/n,s=100,a=Math.round(s/h)),(n<a||o<s||a<10||s<10)&&(a=n,s=o),{srcLeft:r,srcTop:i,srcWidth:n,srcHeight:o,destWidth:a,destHeight:s}}},{key:"_simpleAlgorithm",value:function(t,e,r){for(var i=0,n=0,o=0,a=0,s=0,h=0;h<e;h+=r){var u=t[h+3]/255,l=u/255;i+=t[h]*l,n+=t[h+1]*l,o+=t[h+2]*l,a+=u,s++}var d=a/s,c=Math.round(255*d);return[Math.round(i/s/d*255),Math.round(n/s/d*255),Math.round(o/s/d*255),c]}},{key:"_sqrtAlgorithm",value:function(t,e,r){for(var i=0,n=0,o=0,a=0,s=0,h=0;h<e;h+=r){var u=t[h+3]/255,l=u/255,d=t[h]*l,c=t[h+1]*l,g=t[h+2]*l;i+=d*d,n+=c*c,o+=g*g,a+=u,s++}var v=a/s,_=Math.round(255*v);return[Math.round(255*Math.sqrt(i/s/v)),Math.round(255*Math.sqrt(n/s/v)),Math.round(255*Math.sqrt(o/s/v)),_]}},{key:"_bindImageEvents",value:function(t,e,r){var i=this,n=(r=r||{})&&r.data,o=this._getDefaultColor(r);this._onload=function(){i._unbindImageEvents(t),e.call(t,i.getColor(t,r),n)},this._onerror=function(){i._unbindImageEvents(t),e.call(t,i._prepareResult(o,new Error("Image error")),n)},this._onabort=function(){i._unbindImageEvents(),e.call(t,i._prepareResult(o,new Error("Image abort")),n)},t.addEventListener("load",this._onload),t.addEventListener("error",this._onerror),t.addEventListener("abort",this._onabort)}},{key:"_unbindImageEvents",value:function(t){t.removeEventListener("load",this._onload),t.removeEventListener("error",this._onerror),t.removeEventListener("abort",this._onabort)}},{key:"_prepareResult",value:function(t,e){var r=t.slice(0,3),i=[].concat(r,t[3]/255),n=this._isDark(t);return{error:e,value:t,rgb:"rgb("+r.join(",")+")",rgba:"rgba("+i.join(",")+")",hex:this._arrayToHex(r),hexa:this._arrayToHex(t),isDark:n,isLight:!n}}},{key:"_getOriginalSize",value:function(t){return t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:{width:t.width,height:t.height}}},{key:"_toHex",value:function(t){var e=t.toString(16);return 1===e.length?"0"+e:e}},{key:"_arrayToHex",value:function(t){return"#"+t.map(this._toHex).join("")}},{key:"_isDark",value:function(t){return(299*t[0]+587*t[1]+114*t[2])/1e3<128}}]),t}()});
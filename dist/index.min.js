/*! Fast Average Color | Â© 2018 Denis Seleznev | MIT License | https://github.com/hcodes/fast-average-color/ */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.FastAverageColor=e()}(this,function(){"use strict";var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,r,o){return r&&t(e.prototype,r),o&&t(e,o),e}}();return function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultColor=t&&t.defaultColor||[255,255,255,255]}return t(e,[{key:"getColorFromUnloadedImage",value:function(t,e,r){var o=r&&r.data;t.complete||t.naturalWidth?e.call(t,this.getColor.apply(this,arguments),o):this._bindImageEvents(t,e,r)}},{key:"getColor",value:function(t,e){e=e||{};var r=this._getDefaultColor(e),o=this._prepareSizeAndPosition(t,e),i=null,a=r;if(!(o.srcWidth&&o.srcHeight&&o.destWidth&&o.destHeight))return this._prepareResult(r,new Error("FastAverageColor: Incorrect sizes."));if(!this._ctx&&(this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext&&this._canvas.getContext("2d"),!this._ctx))return this._prepareResult(r,new Error("FastAverageColor: Canvas Context 2D is not supported in this browser."));this._canvas.width=o.destWidth,this._canvas.height=o.destHeight;try{this._ctx.clearRect(0,0,o.destWidth,o.destHeight),this._ctx.drawImage(t,o.srcLeft,o.srcTop,o.srcWidth,o.srcHeight,0,0,o.destWidth,o.destHeight);var n=this._ctx.getImageData(0,0,o.destWidth,o.destHeight).data;a=this.getColorFromArray4(n)}catch(t){i=t}return this._prepareResult(a,i)}},{key:"getColorFromArray3",value:function(t,e){var r=t.length;if(r<3)return this._getDefaultColor();for(var o=r-r%3,i=3*(e||1),a=0,n=0,s=0,h=0,l=0;l<o;l+=i){var u=t[l],d=t[l+1],c=t[l+2];a+=u*u,n+=d*d,s+=c*c,h++}return[Math.floor(Math.sqrt(a/h)),Math.floor(Math.sqrt(n/h)),Math.floor(Math.sqrt(s/h)),255]}},{key:"getColorFromArray4",value:function(t,e){var r=t.length;if(r<4)return this._getDefaultColor();for(var o=r-r%4,i=4*(e||1),a=0,n=0,s=0,h=0,l=0,u=0;u<o;u+=i){var d=t[u+3]/255,c=d/255,f=t[u]*c,v=t[u+1]*c,g=t[u+2]*c;a+=f*f,n+=v*v,s+=g*g,h+=d,l++}var _=h/l,p=Math.floor(255*_);return p?[Math.floor(255*Math.sqrt(a/l/_)),Math.floor(255*Math.sqrt(n/l/_)),Math.floor(255*Math.sqrt(s/l/_)),p]:[0,0,0,0]}},{key:"destroy",value:function(){delete this._canvas,delete this._ctx}},{key:"_getDefaultColor",value:function(t){return t&&t.defaultColor||this.defaultColor}},{key:"_prepareSizeAndPosition",value:function(t,e){var r=this._getOriginalSize(t),o=void 0===e.left?0:e.left,i=void 0===e.top?0:e.top,a=void 0===e.width?r.width:e.width,n=void 0===e.height?r.height:e.height;if("precision"===e.mode)return{srcLeft:o,srcTop:i,srcWidth:a,srcHeight:n,destWidth:a,destHeight:n};var s=a,h=n,l=void 0;return a>n?(l=a/n,s=100,h=Math.floor(s/l)):(l=n/a,h=100,s=Math.floor(h/l)),(s>a||h>n||s<10||h<10)&&(s=a,h=n),{srcLeft:o,srcTop:i,srcWidth:a,srcHeight:n,destWidth:s,destHeight:h}}},{key:"_bindImageEvents",value:function(t,e,r){var o=this,i=r&&r.data;this._onload=function(){o._unbindImageEvents(t),e.call(t,o.getColor(t,r),i)},this._onerror=function(){o._unbindImageEvents(t),e.call(t,o._prepareResult(o._getDefaultColor(),new Error("Image error")),i)},this._onabort=function(){o._unbindImageEvents(),e.call(t,o._prepareResult(o._getDefaultColor(),new Error("Image abort")),i)},t.addEventListener("load",this._onload),t.addEventListener("error",this._onerror),t.addEventListener("abort",this._onabort)}},{key:"_unbindImageEvents",value:function(t){t.removeEventListener("load",this._onload),t.removeEventListener("error",this._onerror),t.removeEventListener("abort",this._onabort)}},{key:"_prepareResult",value:function(t,e){var r=t.slice(0,3),o=[].concat(r,t[3]/255);return{error:e,value:t,rgb:"rgb("+r.join(",")+")",rgba:"rgba("+o.join(",")+")",hex:this._arrayToHex(r),hexa:this._arrayToHex(t),isDark:this._isDark(t)}}},{key:"_getOriginalSize",value:function(t){return t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:{width:t.width,height:t.height}}},{key:"_toHex",value:function(t){var e=t.toString(16);return 1===e.length?"0"+e:e}},{key:"_arrayToHex",value:function(t){return"#"+t.map(this._toHex).join("")}},{key:"_isDark",value:function(t){var e=0;return t.forEach(function(t){e+=t<128?1:0}),e>=2}}]),e}()});